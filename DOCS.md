# How to write, maintain and deploy docs

## Basics

Docs are generated by a tool called [Sphinx](https://www.sphinx-doc.org/en/master/).

Its configuration sits in `docs/conf.py`. That file also contains the configuration for a wide range of *extensions*.

In this project the main extension to care about is [`autoapi`](https://sphinx-autoapi.readthedocs.io/en/latest/index.html). It basically loads all the Python file in the `gflownet/` folder / package and creates the documentation directly from:

1. The file structure (it infers packages and modules from their position in the base folder `gflownet/`)
2. The files' contents: classes, functions, methods etc.
3. The module/package/class/method/function docstrings.

You can learn to write good docstrings here: [Example Google Style Python Docstrings](https://sphinxcontrib-napoleon.readthedocs.io/en/latest/example_google.html#example-google) (this example comes from the Napoleon extension for Sphinx which we use).

In short, do that:

```python
def function_with_pep484_type_annotations(param1: int, param2: str) -> bool:
    """Example function with PEP 484 type annotations.

    Args:
        param1: The first parameter.
        param2: The second parameter.

    Returns:
        The return value. True for success, False otherwise.

    """
```

Note that types will be inferred in the documentation from the Python type hints.

Docstrings are written in `reStructuredText`, a markup language similar to (but much more potent than Markdown). [Here's a quick rst tutorial](https://www.sphinx-doc.org/en/master/usage/restructuredtext/basics.html).

You can also include Maths with `$inline_{math}$` (or `$$ ... $$` for blocks).

Example:

```python
def sample_from_reward(
    self,
    n_samples: int,
    epsilon=1e-4,
) -> TensorType["n_samples", "state_dim"]:
    """
    Rejection sampling  with proposal the uniform distribution in
    $[0, 2\pi]]^{n_dim}$.

    - samples in the returned ``tensor`` are stacked along the first axis
    - the largest ``epsilon`` is, the more samples are accepted

    More info `here <https://en.wikipedia.org/wiki/Rejection_sampling>`_.

    Args:
        n_samples: Number of samples to be generated.
        epsilon: Epsilon for the rejection sampling.

    Returns a tensor in GFlowNet (state) format.
    """
    [...]
```

Renders as:

![docs](https://ibin.co/7EChasL1E4px.png)

## Building the docs yourself

You can easily build the docs and look at what they will look like once they are rendered on Read The Docs:

```bash
pip install -r requirements-dev.txt
```

Then

```bash
cd docs/
sphinx-build -b html . _build
```

When it completes, you can open `docs/_build/index.html`. In spite of warnings, completion is confirmed when the tool prints `The HTML pages are in _build.`.

**About Warnings**

In general you can ignore all that say `WARNING: document isn't included in any toctree`.

Others are usually about rst syntax you should fix.